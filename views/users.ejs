<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('partials/head') %>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
      body {
        font-family: "Inter", system-ui, sans-serif;
      }

      #toast {
        transform: translateX(120%);
        transition: transform 0.3s ease;
      }
      #toast.show {
        transform: translateX(0);
      }

      .profile-card {
        transition: all 0.3s ease;
      }
      .profile-card.expanded {
        border-color: rgba(99, 102, 241, 0.3);
      }

      .modal-overlay {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }
      .modal-overlay.show {
        opacity: 1;
        pointer-events: all;
      }
      .modal-content {
        transform: scale(0.95) translateY(20px);
        transition: transform 0.3s ease;
      }
      .modal-overlay.show .modal-content {
        transform: scale(1) translateY(0);
      }

      /* Tab Navigation Styles */
      .tab-button {
        position: relative;
        transition: all 0.3s ease;
      }
      .tab-button.active {
        color: white;
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.1),
          rgba(139, 92, 246, 0.1)
        );
        border-bottom: 2px solid transparent;
        border-image: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899) 1;
      }
      .tab-button.active::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899);
        border-radius: 2px 2px 0 0;
      }

      /* Beautiful Custom Scrollbar - Always Visible */
      #modalBody {
        scrollbar-width: thin;
        scrollbar-color: rgba(99, 102, 241, 0.7) rgba(15, 23, 42, 0.6);
        overflow-y: auto;
        overflow-x: hidden;
      }

      #modalBody::-webkit-scrollbar {
        width: 12px;
      }

      #modalBody::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 10px;
        margin: 4px;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      #modalBody::-webkit-scrollbar-thumb {
        background: linear-gradient(
          180deg,
          rgba(99, 102, 241, 0.7) 0%,
          rgba(139, 92, 246, 0.7) 50%,
          rgba(236, 72, 153, 0.7) 100%
        );
        border-radius: 10px;
        border: 2px solid rgba(15, 23, 42, 0.6);
        min-height: 40px;
        transition: all 0.2s ease;
      }

      #modalBody::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(
          180deg,
          rgba(99, 102, 241, 0.9) 0%,
          rgba(139, 92, 246, 0.9) 50%,
          rgba(236, 72, 153, 0.9) 100%
        );
        border: 2px solid rgba(99, 102, 241, 0.4);
        box-shadow: 0 0 8px rgba(99, 102, 241, 0.3);
      }

      #modalBody::-webkit-scrollbar-thumb:active {
        background: linear-gradient(
          180deg,
          rgba(99, 102, 241, 1) 0%,
          rgba(139, 92, 246, 1) 50%,
          rgba(236, 72, 153, 1) 100%
        );
      }

      /* Enhanced Modal Design */
      .modal-content {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
          0 0 0 1px rgba(255, 255, 255, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        background: linear-gradient(
          135deg,
          rgba(15, 23, 42, 0.98) 0%,
          rgba(30, 41, 59, 0.98) 50%,
          rgba(15, 23, 42, 0.98) 100%
        );
        position: relative;
      }

      .modal-content::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 1.5rem;
        padding: 1px;
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.3),
          rgba(139, 92, 246, 0.3),
          rgba(236, 72, 153, 0.3),
          rgba(99, 102, 241, 0.3)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: exclude;
        pointer-events: none;
      }

      /* Lightbox Animation */
      #imageLightbox {
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      #imageLightbox.show {
        opacity: 1;
        display: flex !important;
      }
      #lightboxImage {
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.3s ease;
      }
      #imageLightbox.show #lightboxImage {
        opacity: 1;
        transform: scale(1);
      }

      /* Smooth scroll */
      #modalBody {
        scroll-behavior: smooth;
      }

      /* Fade in animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Card hover effects */
      .profile-card-item {
        transition: all 0.3s ease;
      }
      .profile-card-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      }

      /* Badge animations */
      @keyframes pulse-glow {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
      .badge-pulse {
        animation: pulse-glow 2s ease-in-out infinite;
      }

      /* Scrollbar Hide Utility */
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      /* Profile Avatar Fixed Size */
      .profile-avatar {
        width: 64px !important;
        height: 64px !important;
        min-width: 64px !important;
        min-height: 64px !important;
        max-width: 64px !important;
        max-height: 64px !important;
      }

      /* User Avatar Fixed Size */
      .user-avatar {
        width: 64px !important;
        height: 64px !important;
        min-width: 64px !important;
        min-height: 64px !important;
        max-width: 64px !important;
        max-height: 64px !important;
      }

      /* Google Badge - Better Visibility */
      .google-badge {
        color: #60a5fa !important;
        background-color: rgba(59, 130, 246, 0.15) !important;
        border: 1px solid rgba(59, 130, 246, 0.3) !important;
      }

      /* User Info Row - Smaller Fonts */
      .user-info-row {
        font-size: 9px !important;
        color: rgb(148, 163, 184) !important;
      }

      @media (min-width: 640px) {
        .user-info-row {
          font-size: 10px !important;
        }
      }

      /* Joined Date - Ensure Single Line */
      .joined-date {
        font-size: 9px !important;
        white-space: nowrap !important;
      }

      @media (min-width: 640px) {
        .joined-date {
          font-size: 10px !important;
        }
      }

      /* Mobile Responsive Styles */
      @media (max-width: 640px) {
        /* Modal adjustments for mobile */
        .modal-content {
          max-width: 100% !important;
          max-height: 100vh !important;
          border-radius: 0 !important;
          margin: 0 !important;
        }

        .modal-overlay {
          padding: 0 !important;
        }

        /* Toast positioning for mobile */
        #toast {
          top: 1rem;
          right: 1rem;
          left: 1rem;
          max-width: none;
        }

        /* Tab navigation scroll on mobile */
        #modalTabs {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: none;
        }
        #modalTabs::-webkit-scrollbar {
          display: none;
        }

        /* Smaller text on mobile */
        #modalBody h3 {
          font-size: 1rem;
        }
        #modalBody h4 {
          font-size: 0.875rem;
        }
      }
    </style>
  </head>
  <body class="min-h-screen bg-slate-950">
    <%- include('partials/sidebar') %>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-6 right-6 z-[100] max-w-sm">
      <div
        id="toast-content"
        class="rounded-2xl p-4 shadow-2xl flex items-start gap-3 border border-white/10 backdrop-blur-xl"
      >
        <div id="toast-icon" class="shrink-0 w-6 h-6"></div>
        <div class="flex-1 min-w-0">
          <p id="toast-title" class="font-semibold text-sm"></p>
          <p id="toast-message" class="text-sm opacity-80 mt-0.5"></p>
        </div>
        <button
          onclick="hideToast()"
          class="shrink-0 text-white/60 hover:text-white transition-colors"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="lg:pl-64">
      <%- include('partials/dashboardHeader', { pageTitle: 'App Users',
      pageSubtitle: 'Manage users and their profiles' }) %>

      <!-- Page Content -->
      <main class="p-3 sm:p-4 lg:p-6">
        <!-- Header Actions -->
        <div class="flex flex-col gap-3 sm:gap-4 mb-4 sm:mb-6">
          <!-- Search -->
          <div class="relative w-full">
            <input
              type="text"
              id="searchInput"
              placeholder="Search by email, username..."
              class="bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 pl-10 py-2.5 sm:py-3 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-indigo-500/50 w-full"
              onkeyup="handleSearch(event)"
            />
            <svg
              class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </div>

          <!-- Filters Row -->
          <div
            class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3"
          >
            <!-- Filter by status -->
            <select
              id="statusFilter"
              onchange="loadUsers()"
              class="flex-1 sm:flex-none bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-indigo-500/50 min-w-0"
            >
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
            <!-- Filter by verification -->
            <select
              id="verificationFilter"
              onchange="loadUsers()"
              class="flex-1 sm:flex-none bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:border-indigo-500/50 min-w-0"
            >
              <option value="">All Users</option>
              <option value="true">Verified</option>
              <option value="false">Unverified</option>
            </select>
          </div>
        </div>

        <!-- Users List -->
        <div id="usersContainer" class="space-y-4">
          <!-- Loading state -->
          <div id="loadingState" class="text-center py-12">
            <div class="flex items-center justify-center gap-3">
              <div
                class="w-5 h-5 border-2 border-indigo-500/30 border-t-indigo-500 rounded-full animate-spin"
              ></div>
              <span class="text-slate-400">Loading users...</span>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div
          id="pagination"
          class="flex flex-col sm:flex-row items-center justify-between gap-3 sm:gap-0 mt-4 sm:mt-6 px-3 sm:px-4 py-3 sm:py-4 bg-slate-900/50 border border-white/5 rounded-2xl"
        >
          <p
            id="paginationInfo"
            class="text-xs sm:text-sm text-slate-400 text-center sm:text-left"
          >
            Showing 0 of 0 users
          </p>
          <div class="flex items-center gap-2">
            <button
              id="prevBtn"
              onclick="changePage(-1)"
              disabled
              class="px-3 sm:px-4 py-1.5 text-xs sm:text-sm text-slate-400 bg-slate-800/50 rounded-lg hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              <span class="hidden sm:inline">Previous</span>
              <span class="sm:hidden">Prev</span>
            </button>
            <span
              id="pageInfo"
              class="px-3 sm:px-4 py-1.5 text-xs sm:text-sm text-white bg-indigo-500/20 rounded-lg min-w-[2.5rem] text-center"
              >1</span
            >
            <button
              id="nextBtn"
              onclick="changePage(1)"
              disabled
              class="px-3 sm:px-4 py-1.5 text-xs sm:text-sm text-slate-400 bg-slate-800/50 rounded-lg hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              Next
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- Profile Details Modal -->
    <div
      id="profileModal"
      class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-0 sm:p-4 bg-gradient-to-br from-black/80 via-slate-900/80 to-black/80 backdrop-blur-xl"
    >
      <div
        class="modal-content rounded-none sm:rounded-3xl w-full h-full sm:h-auto max-w-6xl sm:max-h-[92vh] overflow-hidden flex flex-col relative px-3 sm:px-4 py-3 sm:py-4"
      >
        <!-- Fixed Header Section -->
        <div class="flex-shrink-0 z-10 bg-slate-900/95 backdrop-blur-sm">
          <!-- Beautiful Enhanced Modal Header -->
          <div class="relative overflow-hidden">
            <!-- Animated Background Gradient -->
            <div
              class="absolute inset-0 bg-gradient-to-br from-indigo-500/10 via-purple-500/10 to-pink-500/10"
            ></div>
            <div
              class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-indigo-500/5 via-transparent to-transparent"
            ></div>

            <!-- Header Content -->
            <div
              class="relative p-4 sm:p-6 lg:p-10 pb-4 sm:pb-6 lg:pb-8 border-b border-white/10 bg-slate-900/50"
            >
              <div
                class="flex items-start justify-between gap-3 sm:gap-4 lg:gap-6"
              >
                <div
                  class="flex items-start gap-3 sm:gap-4 lg:gap-6 flex-1 min-w-0"
                >
                  <!-- Enhanced Avatar with Glow Effect -->
                  <div class="relative shrink-0 group">
                    <div
                      class="absolute inset-0 rounded-2xl sm:rounded-3xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-[2px] sm:p-[3px] opacity-70 group-hover:opacity-100 transition-opacity"
                    ></div>
                    <div
                      class="absolute inset-0 rounded-2xl sm:rounded-3xl bg-gradient-to-br from-indigo-500/25 via-purple-500/25 to-pink-500/25 blur-xl sm:blur-2xl"
                    ></div>
                    <div
                      id="modalAvatar"
                      class="relative !w-16 !h-16 sm:!w-24 sm:!h-24 lg:!w-32 lg:!h-32 rounded-2xl sm:rounded-3xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center text-white font-bold text-xl sm:text-2xl lg:text-4xl overflow-hidden border-2 sm:border-4 border-slate-900 shadow-2xl"
                    ></div>
                  </div>

                  <!-- User Info Section - Redesigned Layout -->
                  <div class="flex-1 min-w-0">
                    <!-- Name and Badges Row -->
                    <div
                      class="flex items-center gap-2 sm:gap-3 lg:gap-4 mb-2 sm:mb-3 flex-wrap"
                    >
                      <h2
                        id="modalName"
                        class="text-white font-bold text-lg sm:text-2xl lg:text-3xl leading-tight tracking-tight"
                        style="letter-spacing: -0.02em"
                      ></h2>
                      <div
                        id="modalBadges"
                        class="flex items-center gap-1.5 sm:gap-2 lg:gap-2.5 shrink-0 flex-wrap"
                      >
                        <!-- Badges will be populated by JavaScript -->
                      </div>
                    </div>

                    <!-- Username Row -->
                    <p
                      id="modalUsername"
                      class="text-slate-300 text-sm sm:text-base font-medium mb-2 sm:mb-3 lg:mb-4"
                    ></p>

                    <!-- Meta Info Row -->
                    <div
                      id="modalMeta"
                      class="flex items-center gap-2 sm:gap-3 lg:gap-5 text-xs sm:text-sm text-slate-400 flex-wrap"
                    >
                      <!-- Meta info will be populated by JavaScript -->
                    </div>
                  </div>
                </div>

                <!-- Close Button -->
                <button
                  onclick="closeProfileModal()"
                  class="p-2 sm:p-2.5 text-slate-400 hover:text-white hover:bg-white/10 rounded-lg sm:rounded-xl transition-all hover:rotate-90 shrink-0 backdrop-blur-sm border border-white/5"
                >
                  <svg
                    class="w-5 h-5 sm:w-6 sm:h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Tab Navigation -->
          <div
            id="modalTabs"
            class="flex items-center gap-1 px-3 sm:px-4 lg:px-6 pt-2 pb-0 border-b border-white/5 overflow-x-auto bg-slate-900/50 backdrop-blur-sm flex-shrink-0 sticky top-0 z-10 scrollbar-hide"
          >
            <!-- Tabs will be populated by JavaScript -->
          </div>
        </div>

        <!-- Scrollable Modal Body -->
        <div
          id="modalBody"
          class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 bg-gradient-to-b from-slate-900/80 via-slate-900 to-slate-900/95 min-h-0"
          style="
            max-height: calc(100vh - 180px);
            max-height: calc(92vh - 200px);
          "
        >
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Image Lightbox Modal -->
    <div
      id="imageLightbox"
      class="fixed inset-0 z-[60] hidden items-center justify-center p-4 bg-black/90 backdrop-blur-md"
    >
      <div
        class="relative max-w-7xl max-h-[95vh] w-full h-full flex items-center justify-center"
      >
        <button
          onclick="closeLightbox()"
          class="absolute top-4 right-4 p-3 text-white hover:bg-white/10 rounded-xl transition-colors z-10"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
        <button
          onclick="lightboxPrev()"
          class="absolute left-4 p-3 text-white hover:bg-white/10 rounded-xl transition-colors z-10"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <button
          onclick="lightboxNext()"
          class="absolute right-4 p-3 text-white hover:bg-white/10 rounded-xl transition-colors z-10"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </button>
        <img
          id="lightboxImage"
          src=""
          alt=""
          class="max-w-full max-h-full object-contain rounded-lg"
        />
        <div
          id="lightboxInfo"
          class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/60 backdrop-blur-sm px-4 py-2 rounded-xl text-white text-sm"
        >
          <!-- Image info -->
        </div>
      </div>
    </div>

    <script src="/js/config.js"></script>
    <script src="/js/users.js"></script>
    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");
        sidebar.classList.toggle("-translate-x-full");
        overlay.classList.toggle("hidden");
      }
      function toggleProfileMenu() {
        const menu = document.getElementById("profileMenu");
        menu.classList.toggle("hidden");
      }
      document.addEventListener("click", function (e) {
        const menu = document.getElementById("profileMenu");
        const button = e.target.closest('[onclick="toggleProfileMenu()"]');
        if (!button && !menu.contains(e.target)) {
          menu.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
